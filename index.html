<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8"/>
    <title>webAR</title>
    <meta name="viewport"
          content="width=device-width, initial-scale=1, maximum-scale=1,minimum-scale=1, user-scalable=no">
    <meta http-equiv="Permissions-Policy" content="interest-cohort=()">
    <!-- 强制浏览器每次请求资源时，从服务器下载最新资源。强制清除缓存，防止参数出错 -->
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Cache-Control" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <!-- ############################################################### -->
    <!-- css -->
    <link rel="stylesheet" href="css/swiper-bundle.min.css"/>
    <link rel="stylesheet" href="./css/index.css">
    <!-- script -->
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <script src="script/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <script src="script/jquery.js"></script>
    <!-- 手势检测js -->
    <script src="./script/gesture-detector.js"></script>
    <script src="./script/gesture-handler.js"></script>

    <script>
        $(function () {
            //一段正则，匹配所有_min.的图片src属性
            let test = /_min\./
            //遍历所有的图片节点
            $("img").each(function (index, obj) {
                if (test.test($(this).attr("src"))) {
                    var reSrc = $(this).attr("src").replace(test, ".");
                    $(this).attr("src", reSrc)
                }
            })

            // 网页初始化
            window.addEventListener("camera-init", (event) => {
                let tem = document.body.offsetWidth;
                let intervalBox = setInterval(function () {
                    if (document.body.offsetWidth > tem) {
                        myInit();
                        clearInterval(intervalBox);//清除interval定时器
                    }
                }, 1000);

            });


        })

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        function myInit() {
            let dis = Math.ceil((document.body.offsetWidth - window.innerWidth) / 2);
            $("#l-img").css("left", dis + "px");
            $("#r-img").css("right", dis + "px");
            // sleep(5000);
            $("#sk-fa").remove();
            if (getCookie("index_flag") == null) {
                // 引导操作
                swal("Добро пожаловать в древний мир Китая, сканируйте вспомогательную графику, чтобы раскрыть тайны китайской культуры.", {
                    buttons: false,
                    className: "swal-overlay",
                });
                setCookie("index_flag", "true", "s300");
            }
            $("#logo-btn").css("pointer-events", "auto");
            $("#btn").css({"pointer-events": "auto"});
            $("#rbtn").css({"pointer-events": "auto"});
            $("#play-btn").css({"pointer-events": "auto"});
        }

        // 设置cookie
        // 设定过期时间的使用示例：
        // s20是代表20秒
        // h是指小时，如12小时则是：h12
        // d是天数，30天则：d30
        function setCookie(name, value, time) {
            let strsec = getsec(time);
            let exp = new Date();
            exp.setTime(exp.getTime() + strsec * 1);
            document.cookie = name + "=" + escape(value) + ";expires=" + exp.toGMTString();
        }

        // 设置过期时间
        function getsec(str) {
            let str1 = str.substring(1, str.length) * 1;
            let str2 = str.substring(0, 1);
            if (str2 === "s") {
                return str1 * 1000;
            } else if (str2 === "h") {
                return str1 * 60 * 60 * 1000;
            } else if (str2 === "d") {
                return str1 * 24 * 60 * 60 * 1000;
            }
        }

        // 读取cookie
        function getCookie(cookieName) {
            const strCookie = document.cookie;
            const cookieList = strCookie.split(';');

            for (let i = 0; i < cookieList.length; i++) {
                const arr = cookieList[i].split('=');
                if (cookieName === arr[0].trim()) {
                    return arr[1];
                }
            }

            return null;
        }
    </script>
</head>

<body>
<div id="sk-fa">
    <div class="sk-chase">
        <div class="sk-chase-dot"></div>
        <div class="sk-chase-dot"></div>
        <div class="sk-chase-dot"></div>
        <div class="sk-chase-dot"></div>
        <div class="sk-chase-dot"></div>
        <div class="sk-chase-dot"></div>
    </div>
</div>
<!-- 导航栏 -->
<nav>
    <div class="logo"><a href="javascript:void(0)" id="logo-btn" onclick="logoClick()"
                         style="pointer-events: none;"></a></div>
    <script>
        function logoClick() {
            let slide_sec1 = document.getElementById("slide-sec");
            let myIframe = document.getElementById("my-iframe");
            myIframe.src = "long.html?id=0";
            let w = Math.ceil((document.body.offsetWidth - window.innerWidth) / 2);
            slide_sec1.style.setProperty('left', w + "px", 'important');
            slide_sec1.style.setProperty('visibility', 'visible', 'important');
        }
    </script>
</nav>

<a-scene
        embedded
        arjs
        renderer="logarithmicDepthBuffer: true;"
        vr-mode-ui="enabled: false"
        cursor="rayOrigin: mouse; fuse: false"
        raycaster="objects: .click_img"
        gesture-detector
        id="scene">
    <a-assets>
        <img id="a1" src="images/animal/1.png">
    </a-assets>

    <a-assets>
        <img id="a2" src="images/animal/3.png">
    </a-assets>

    <a-assets>
        <img id="a3" src="images/animal/2.png">
    </a-assets>

    <a-assets>
        <img id="a4" src="images/animal/4.png">
    </a-assets>

    <a-assets>
        <img id="a5" src="images/animal/5.png">
    </a-assets>

    <a-marker type="pattern" url="pattern-maker/pattern-1.patt">
        <a-image
                src="#a1"
                height="1.5"
                width="1.5"
                rotation="-90 0 0"
                animation="property: scale; to: 1.5 1.5 2; dur: 2000; easing: linear; loop: true"
                class="clickable"
                cursor-listener
                markerhandler
                gesture-handler="minScale: 0.25; maxScale: 10">
        </a-image>
    </a-marker>

    <a-marker type="pattern" url="pattern-maker/pattern-2.patt">
        <a-image
                src="#a2"
                height="1.5"
                width="1.5"
                rotation="-90 0 0"
                animation="property: rotation; to: -90 360 0; loop: true; dur: 5000"
                class="clickable"
                cursor-listener
                markerhandler
                gesture-handler="minScale: 0.25; maxScale: 10">
        </a-image>
    </a-marker>

    <a-marker type="pattern" url="pattern-maker/pattern-3.patt">
        <a-image
                src="#a3"
                height="1.5"
                width="1.5"
                rotation="-90 0 0"
                animation="property: position; to: 0 1 0; dur: 2000; easing: linear; loop: true"
                class="clickable"
                cursor-listener
                markerhandler
                gesture-handler="minScale: 0.25; maxScale: 10">
        </a-image>
    </a-marker>

    <a-marker type="pattern" url="pattern-maker/pattern-4.patt">
        <a-image
                src="#a4"
                height="1.5"
                width="1.5"
                rotation="-90 0 0"
                animation="property: scale; to: 1.5 1.5 2; dur: 2000; easing: linear; loop: true"
                class="clickable"
                cursor-listener
                markerhandler
                gesture-handler="minScale: 0.25; maxScale: 10">
        </a-image>
    </a-marker>

    <a-marker type="pattern" url="pattern-maker/pattern-5.patt">
        <a-image
                src="#a5"
                height="1.5"
                width="1.5"
                rotation="-90 0 0"
                animation="property: rotation; to: -90 360 0; loop: true; dur: 5000"
                class="clickable"
                cursor-listener
                markerhandler
                gesture-handler="minScale: 0.25; maxScale: 10">
        </a-image>
    </a-marker>

    <a-marker type="pattern" url="pattern-maker/pattern-6.patt">
        <a-image
                src="#a4"
                height="1.5"
                width="1.5"
                rotation="-90 0 0"
                animation="property: scale; to: 1.5 1.5 2; dur: 2000; easing: linear; loop: true"
                class="clickable"
                cursor-listener
                markerhandler
                gesture-handler="minScale: 0.25; maxScale: 10">
        </a-image>
    </a-marker>

    <a-marker type="pattern" url="pattern-maker/pattern-7.patt">
        <a-image
                src="#a3"
                height="1.5"
                width="1.5"
                rotation="-90 0 0"
                animation="property: position; to: 0 1 0; dur: 2000; easing: linear; loop: true"
                class="clickable"
                cursor-listener
                markerhandler
                gesture-handler="minScale: 0.25; maxScale: 10">
        </a-image>
    </a-marker>

    <a-marker type="pattern" url="pattern-maker/pattern-8.patt">
        <a-image
                src="#a2"
                height="1.5"
                width="1.5"
                rotation="-90 0 0"
                animation="property: rotation; to: -90 360 0; loop: true; dur: 5000"
                class="clickable"
                cursor-listener
                markerhandler
                gesture-handler="minScale: 0.25; maxScale: 10">
        </a-image>
    </a-marker>

    <a-marker type="pattern" url="pattern-maker/pattern-9.patt">
        <a-image
                src="#a1"
                height="1.5"
                width="1.5"
                rotation="-90 0 0"
                animation="property: scale; to: 1.5 1.5 2; dur: 2000; easing: linear; loop: true"
                class="clickable"
                cursor-listener
                markerhandler
                gesture-handler="minScale: 0.25; maxScale: 10">
        </a-image>
    </a-marker>

    <a-marker type="pattern" url="pattern-maker/pattern-10.patt">
        <a-image
                src="#a2"
                height="1.5"
                width="1.5"
                rotation="-90 0 0"
                animation="property: rotation; to: -90 360 0; loop: true; dur: 5000"
                class="clickable"
                cursor-listener
                markerhandler
                gesture-handler="minScale: 0.25; maxScale: 10">
        </a-image>
    </a-marker>

    <a-marker type="pattern" url="pattern-maker/pattern-11.patt">
        <a-image
                src="#a3"
                height="1.5"
                width="1.5"
                rotation="-90 0 0"
                animation="property: position; to: 0 1 0; dur: 2000; easing: linear; loop: true"
                class="clickable"
                cursor-listener
                markerhandler
                gesture-handler="minScale: 0.25; maxScale: 10">
        </a-image>
    </a-marker>

    <a-marker type="pattern" url="pattern-maker/pattern-12.patt">
        <a-image
                src="#a4"
                height="1.5"
                width="1.5"
                rotation="-90 0 0"
                animation="property: scale; to: 1.5 1.5 2; dur: 2000; easing: linear; loop: true"
                class="clickable"
                cursor-listener
                markerhandler
                gesture-handler="minScale: 0.25; maxScale: 10">
        </a-image>
    </a-marker>

    <a-marker type="pattern" url="pattern-maker/pattern-13.patt">
        <a-image
                src="#a5"
                height="1.5"
                width="1.5"
                rotation="-90 0 0"
                animation="property: rotation; to: -90 360 0; loop: true; dur: 5000"
                class="clickable"
                cursor-listener
                markerhandler
                gesture-handler="minScale: 0.25; maxScale: 10">
        </a-image>
    </a-marker>

    <a-marker type="pattern" url="pattern-maker/pattern-14.patt">
        <a-image
                src="#a4"
                height="1.5"
                width="1.5"
                rotation="-90 0 0"
                animation="property: scale; to: 1.5 1.5 2; dur: 2000; easing: linear; loop: true"
                class="clickable"
                cursor-listener
                markerhandler
                gesture-handler="minScale: 0.25; maxScale: 10">
        </a-image>
    </a-marker>

    <a-marker type="pattern" url="pattern-maker/pattern-15.patt">
        <a-image
                src="#a3"
                height="1.5"
                width="1.5"
                rotation="-90 0 0"
                animation="property: position; to: 0 1 0; dur: 2000; easing: linear; loop: true"
                class="clickable"
                cursor-listener
                markerhandler
                gesture-handler="minScale: 0.25; maxScale: 10">
        </a-image>
    </a-marker>

    <a-marker type="pattern" url="pattern-maker/pattern-16.patt">
        <a-image
                src="#a2"
                height="1.5"
                width="1.5"
                rotation="-90 0 0"
                animation="property: rotation; to: -90 360 0; loop: true; dur: 5000"
                class="clickable"
                cursor-listener
                markerhandler
                gesture-handler="minScale: 0.25; maxScale: 10">
        </a-image>
    </a-marker>
    <a-entity camera>
    </a-entity>
</a-scene>

<script>
    // click_img clickable
    AFRAME.registerComponent('markerhandler', {
        init: function () {
            this.el.sceneEl.addEventListener('markerFound', () => {
                let currElement = window.event.srcElement.firstElementChild;
                let currSrc = currElement.getAttribute("src");
                currElement.setAttribute("class", "clickable click_img");
                if (currSrc === "#a1") {
                    currElement.setAttribute("sound", "src: url(sound/1.mp3); autoplay: true");
                } else if (currSrc === "#a2") {
                    currElement.setAttribute("sound", "src: url(sound/2.mp3); autoplay: true");
                } else if (currSrc === "#a3") {
                    currElement.setAttribute("sound", "src: url(sound/3.mp3); autoplay: true");
                } else if (currSrc === "#a4") {
                    currElement.setAttribute("sound", "src: url(sound/4.mp3); autoplay: true");
                } else if (currSrc === "#a5") {
                    currElement.setAttribute("sound", "src: url(sound/5.mp3); autoplay: true");
                }
            })

            this.el.sceneEl.addEventListener('markerLost', () => {
                let currElement = window.event.srcElement.firstElementChild;
                currElement.setAttribute("class", "clickable");
                currElement.removeAttribute("sound");
            })
        }
    });
    AFRAME.registerComponent('cursor-listener', {
        init: function () {
            this.el.addEventListener('click', function (evt) {
                let slide_sec1 = document.getElementById("slide-sec");
                let myIframe = document.getElementById("my-iframe");
                myIframe.src = "long.html?id=" + this.getAttribute("src")[2];
                let w = Math.ceil((document.body.offsetWidth - window.innerWidth) / 2);
                slide_sec1.style.setProperty('left', w + "px", 'important');
                slide_sec1.style.setProperty('visibility', 'visible', 'important');
            });
        }
    });
</script>

<!-- 轮播器 -->
<div class="my_swiper clearfix" id="my_swiper">
    <div class="swiper">
        <!-- Additional required wrapper -->
        <div class="swiper-wrapper">
            <!-- Slides -->
            <a href="javascript:void(0)" class="swiper-slide swiper-slide-1" id="s1" onclick="myClick()"></a>
            <a href="javascript:void(0)" class="swiper-slide swiper-slide-2" id="s2" onclick="myClick()"></a>
            <a href="javascript:void(0)" class="swiper-slide swiper-slide-3" id="s3" onclick="myClick()"></a>
            <a href="javascript:void(0)" class="swiper-slide swiper-slide-4" id="s4" onclick="myClick()"></a>
            <a href="javascript:void(0)" class="swiper-slide swiper-slide-5" id="s5" onclick="myClick()"></a>
            <a href="javascript:void(0)" class="swiper-slide swiper-slide-6" id="s6" onclick="myClick()"></a>
        </div>

        <div class="swiper-pagination"></div>
        <div class="swiper-button-prev"></div>
        <div class="swiper-button-next"></div>
    </div>

    <!-- 轮播器js -->
    <script src="https://unpkg.com/swiper@7/swiper-bundle.min.js"></script>
    <script>
        const swiper = new Swiper('.swiper', {
            effect: 'coverflow',
            loop: true,
            grabCursor: true,
            centeredSlides: true,
            slidesPerView: 'auto',
            coverflowEffect: {
                rotate: 0,
                stretch: 0,
                depth: 150,
                modifier: 1,
                slideShadows: false,
            },
            pagination: {
                el: '.swiper-pagination',
            },
            navigation: {
                nextEl: '.swiper-button-next',
                prevEl: '.swiper-button-prev',
            },
        });

        function myClick() {
            let obj = window.event.currentTarget;
            let obj_id = parseInt(obj.id[1]);
            let slide_sec1 = document.getElementById("slide-sec");
            let myIframe = document.getElementById("my-iframe");
            myIframe.src = myIframe.getAttribute('data-src') + "?id=" + obj_id;
            let w = Math.ceil((document.body.offsetWidth - window.innerWidth) / 2);
            slide_sec1.style.setProperty('left', w + "px", 'important');
            slide_sec1.style.setProperty('visibility', 'visible', 'important');
        }
    </script>
</div>

<!-- 轮播卡片 -->
<div id="slide-sec">
    <iframe data-src="3dbox.html"
            width="100%" height="100%" frameborder="0"
            allowfullscreen id="my-iframe"></iframe>
</div>

<!-- 左按钮 -->
<a href="javascript:void(0)" class="container" id="btn" onclick="lclick()" style="pointer-events: none;">
    <img src="images/8.png" alt="">
</a>

<script>
    let btn = document.getElementById("btn");
    let my_swiper = document.getElementById("my_swiper");
    let innerw = window.innerWidth;

    function lclick() {
        if (btn.style.backgroundSize === "400%") {
            btn.style.backgroundColor = "#fff";
            btn.style.backgroundSize = "0";
            my_swiper.style.display = "none";
            <!-- 按钮选中期间其余按钮不可选中 -->
            $("#logo-btn").css("pointer-events", "auto", "important");
            $("#rbtn").css({"pointer-events": "auto", "background-color": "#fff"});
            $("#play-btn").css({"pointer-events": "auto"});
        } else {
            btn.style.background = "linear-gradient(90deg, #fa7199, #f5ce62, #e43603, #fa7199)";
            btn.style.backgroundSize = "400%";
            if (innerw < 1025) {
                let offw = document.body.offsetWidth;
                let marginL = Math.ceil((offw - innerw) / 2);
                my_swiper.style.setProperty("margin-left", marginL + "px", "important");
                $("#logo-btn").css("pointer-events", "none", "important");
                $("#rbtn").css({"pointer-events": "none", "background-color": "#3B3B3B"});
                $("#play-btn").css({"pointer-events": "none"});
            }
            my_swiper.style.display = "block";
        }
    }
</script>

<!-- 右按钮 -->
<a href="javascript:void(0)" class="rcontainer" id="rbtn" onclick="rclick()" style="pointer-events: none;">
    <img src="images/7.png" alt="">
</a>

<script>
    let rbtn = document.getElementById("rbtn");

    function rclick() {
        rbtn.style.background = "linear-gradient(90deg, #fa7199, #f5ce62, #e43603, #fa7199)";
        rbtn.style.backgroundSize = "400%";
        let slide_sec1 = document.getElementById("slide-sec");
        let myIframe = document.getElementById("my-iframe");
        myIframe.src = "long.html?id=1";
        let w = Math.ceil((document.body.offsetWidth - window.innerWidth) / 2);
        slide_sec1.style.setProperty('left', w + "px", 'important');
        slide_sec1.style.setProperty('visibility', 'visible', 'important');
        $("#logo-btn").css("pointer-events", "none", "important");
        $("#btn").css({"pointer-events": "none", "background-color": "#3B3B3B"});
        $("#play-btn").css({"pointer-events": "none"});
    }
</script>

<!-- 视频按钮 -->
<a href="javascript:void(0)" class="play-container" id="play-btn" onclick="playClick()" style="pointer-events: none;">
    <img src="images/play.png" alt="">
</a>

<script>
    // let playDtn = document.getElementById("play-btn");

    function playClick() {
        let slide_sec1 = document.getElementById("slide-sec");
        let myIframe = document.getElementById("my-iframe");
        myIframe.src = "video.html?";
        let w = Math.ceil((document.body.offsetWidth - window.innerWidth) / 2);
        slide_sec1.style.setProperty('left', w + "px", 'important');
        slide_sec1.style.setProperty('visibility', 'visible', 'important');
    }
</script>

<!-- 边框 -->
<div id="l-img" class="border-img"></div>
<div id="r-img" class="border-img"></div>
</body>
</html>