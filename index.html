<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8"/>
    <meta name="viewport"
          content="width=device-width, initial-scale=1, maximum-scale=1,minimum-scale=1, user-scalable=no">
    <meta http-equiv="Permissions-Policy" content="interest-cohort=()">
    <title>webAR</title>
    <script src="https://cdn.jsdelivr.net/gh/aframevr/aframe@1.3.0/dist/aframe-master.min.js"></script>
    <!-- rawgithack development URL -->
    <script src='https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js'></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.7.1/jquery.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"/>
    <link rel="stylesheet" href="https://unpkg.com/swiper@7/swiper-bundle.min.css"/>
    <link rel="stylesheet" href="./css/index.css">
    <!-- 手势检测js -->
    <script src="./script/gesture-detector.js"></script>
    <script src="./script/gesture-handler.js"></script>

    <script>
        AFRAME.registerComponent('rotation-reader', {
            /**
             * We use IIFE (immediately-invoked function expression) to only allocate one
             * vector or euler and not re-create on every tick to save memory.
             */
            tick: (function () {
                var position = new THREE.Vector3();
                var quaternion = new THREE.Quaternion();

                return function () {
                    this.el.object3D.getWorldPosition(position);
                    this.el.object3D.getWorldQuaternion(quaternion);
                    // position and rotation now contain vector and quaternion in world space.
                };
            })()
        });
    </script>

    <script>
        $(function () {
            //一段正则，匹配所有_min.的图片src属性
            let test = /_min\./
            //遍历所有的图片节点
            $("img").each(function (index, obj) {
                if (test.test($(this).attr("src"))) {
                    var reSrc = $(this).attr("src").replace(test, ".");
                    $(this).attr("src", reSrc)
                }
            })
        })
    </script>
</head>

<body>
<!-- 导航栏 -->
<nav>
    <div class="logo"></div>
</nav>

<!-- 加载动画效果 -->
<div class="arjs-loader">
    <div>
        <!--        Loading, please wait...-->
        <span style="--i: 1">l</span>
        <span style="--i: 2">o</span>
        <span style="--i: 3">a</span>
        <span style="--i: 4">d</span>
        <span style="--i: 5">i</span>
        <span style="--i: 6">n</span>
        <span style="--i: 7">g</span>
        <span style="--i: 8">.</span>
        <span style="--i: 9">.</span>
        <span style="--i: 10">.</span>
    </div>
</div>

<!-- 图像追踪 -->
<a-scene
        arjs='trackingMethod: best; sourceType: webcam; debugUIEnabled: false;'
        embedded
        renderer="logarithmicDepthBuffer: true;"
        vr-mode-ui="enabled: false;"
        gesture-detector
        id="scene"
>
    <!-- use rawgithack to retrieve the correct url for nft marker (see 'pinball' below) -->
    <a-nft
            type="nft"
            url="./trex/trex-image/trex"
            smooth="true"
            smoothCount="10"
            smoothTolerance="0.01"
            smoothThreshold="5"
            raycaster="objects: .clickable"
            emitevents="true"
            cursor="fuse: false; rayOrigin: mouse;"
    >
        <a-entity
                gltf-model='https://cdn.glitch.com/06bd98b4-97ee-4c07-a546-fe39ca205034%2Fbowser.glb'
                scale="5 5 5"
                position="50 150 0"
                class="clickable"
                gesture-handler="minScale: 0.25; maxScale: 10"
        >
        </a-entity>
    </a-nft>
    <a-entity camera></a-entity>
</a-scene>

<!-- 轮播器 -->
<div class="my_swiper clearfix" id="my_swiper">
    <div class="swiper">
        <!-- Additional required wrapper -->
        <div class="swiper-wrapper">
            <!-- Slides -->
            <a href="javascript:void(0)" class="swiper-slide swiper-slide-1" id="s1" onclick="myClick()"></a>
            <a href="javascript:void(0)" class="swiper-slide swiper-slide-2" id="s2" onclick="myClick()"></a>
            <a href="javascript:void(0)" class="swiper-slide swiper-slide-3" id="s3" onclick="myClick()"></a>
            <a href="javascript:void(0)" class="swiper-slide swiper-slide-4" id="s4" onclick="myClick()"></a>
            <a href="javascript:void(0)" class="swiper-slide swiper-slide-5" id="s5" onclick="myClick()"></a>
            <a href="javascript:void(0)" class="swiper-slide swiper-slide-6" id="s6" onclick="myClick()"></a>
        </div>

        <div class="swiper-pagination"></div>
        <div class="swiper-button-prev"></div>
        <div class="swiper-button-next"></div>
    </div>

    <!-- 轮播器js -->
    <script src="https://unpkg.com/swiper@7/swiper-bundle.min.js"></script>
    <script>
        const swiper = new Swiper('.swiper', {
            effect: 'coverflow',
            loop: true,
            grabCursor: true,
            centeredSlides: true,
            slidesPerView: 'auto',
            coverflowEffect: {
                rotate: 0,
                stretch: 0,
                depth: 150,
                modifier: 1,
                slideShadows: false,
            },
            pagination: {
                el: '.swiper-pagination',
            },
            navigation: {
                nextEl: '.swiper-button-next',
                prevEl: '.swiper-button-prev',
            },
        });

        function myClick() {
            let obj = window.event.currentTarget;
            let obj_id = parseInt(obj.id[1]);
            console.log("obj", obj);
            console.log("obj_id", obj_id);
            let slide_sec1 = document.getElementById("slide-sec");
            let myIframe = document.getElementById("my-iframe");
            console.log("slide_sec1", slide_sec1);
            console.log("myIframe", myIframe);
            console.log("myIframe.src", myIframe.src);
            // myIframe.src = myIframe.getAttribute('data-src') + "?id=" + obj_id;
            slide_sec1.style.setProperty('visibility', 'visible', 'important');
        }
    </script>
</div>

<!-- 轮播卡片 -->
<div id="slide-sec">
    <iframe data-src="3dbox.html"
            width="100%" height="100%" frameborder="0"
            allowfullscreen id="my-iframe"></iframe>
</div>

<!--<div class="details" id="details">-->
<!--    <div class="back-btn">-->
<!--        <a href="javascript:void(0)" id="details-back-btn" onclick="detailsBackClick()"><img src="images/back-btn.png"></a>-->
<!--    </div>-->
<!--    <img src="images/box/front1.png" alt="" id="details-img">-->

<!--    <script>-->
<!--        function detailsBackClick() {-->
<!--            let obj = document.getElementById("details");-->
<!--            obj.style.setProperty('display', 'none', 'important');-->
<!--        }-->
<!--    </script>-->
<!--</div>-->

<div class="container">
    <a href="javascript:void(0)" class="btn" id="btn"><i class="fa fa-instagram"></i></a>

    <script>
        let btn = document.getElementById("btn");
        let my_swiper = document.getElementById("my_swiper")
        let innerw = window.innerWidth;
        btn.onclick = function () {
            if (btn.style.backgroundSize === "400%") {
                btn.style.backgroundcolor = "#fff";
                btn.style.backgroundSize = "0";
                my_swiper.style.display = "none";
            } else {
                btn.style.background = "linear-gradient(90deg, #fa7199, #f5ce62, #e43603, #fa7199)";
                btn.style.backgroundSize = "400%";
                if (innerw < 1025) {
                    let offw = document.body.offsetWidth;
                    let marginL = Math.ceil((offw - innerw) / 2);
                    my_swiper.style.setProperty("margin-left", marginL + "px", "important");
                }
                my_swiper.style.display = "block";
            }
        }
    </script>
</div>

</body>
</html>